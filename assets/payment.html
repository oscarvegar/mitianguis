<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Insert title here</title>
		<link rel="stylesheet" href="./css/bootstrap.min.css"></link>
		<!-- link rel="stylesheet" href="./assets/css/mitianguis.css"></link -->
		<script type="text/javascript" src="https://conektaapi.s3.amazonaws.com/v0.3.2/js/conekta.js"></script>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	</head>
	<body>
		<div class="container">
			<h2>Conekta Demo</h2>
			<div class="row">
				<div class="col-md-4">
					<form role="form" id="card-form">
						<div class="form-group">
							<label>Nombre del tarjetahabiente</label>
							<input type="text" class="form-control">
						</div>
						<div class="form-group">
							<label>Número de tarjeta de crédito</label>
							<input type="text" class="form-control">
						</div>
						<div class="row">
							<div class="col-md-4">
								<div class="form-group">
									<label>Mes expiración</label>
									<input type="text" class="form-control" placeholder="MM">
								</div>
							</div>
							<div class="col-md-4">
								<div class="form-group">
									<label>Año expiración</label>
									<input type="text" class="form-control" placeholder="YYYY">
								</div>
							</div>
							<div class="col-md-4">
								<div class="form-group">
									<label>CVC</label>
									<input type="text" class="form-control" placeholder="Ex. 331">
								</div>
							</div>
						</div>
						<button type="submit" class="btn btn-primary">¡Suscribirse ahora!</button>
					</form>
				</div>
				<div class="col-md-4"></div>
				<div class="col-md-4"></div>
			</div>
		</div>
		<script type="text/javascript">
			Conekta.setPublishableKey('key_Oxhifz8dyqLeZ3xYqfGczng');
			
			conektaSuccessResponseHandler = function(token){
				var $form = $("#card-form");
				console.log(token)
				$form.append($("<input type=\"hidden\" name=\"conektaTokenId\" />").val(token.id));
				$form.get(0).submit();
			}
			
			conektaErrorResponseHandler = function(response){
				var $form = $("#card-form");
				$form.find(".card-errors").text(response.message);
				$form.find("button").prop("disabled", false);
			}
			
			$("#card-form").submit(function(event) {
				var $form = $(this);
				if(validateFormData($form)) {
					$form.find("button").prop("disabled", true);
					Conekta.token.create($form, conektaSuccessResponseHandler, conektaErrorResponseHandler);
					return false;
				}
			});
			
			validateFormData = function(forma) {
				alert('Validando informacion de la forma :: ' + forma);
				/* Revisa que el número de la tarjeta esté formado de manera correcta y que pasa la prueba de Luhn exitosamente. */
				if(!Conekta.card.validateNumber()) {
					alert('El número de la tarjeta es inválido, favor de verificar.');
					return false;
				}
				
				/* Este validador revisa si la fecha de expiración es una fecha válida y futura. */
				if(!Conekta.card.validateExpirationDate()) {
					alert('La fecha de expiración no es una fecha válida y futura, favor de verificar.');
					return false;
				}
				
				/* Este validador revisa si el código de seguridad es un entero válido (de 3 a 4 caracteres). */
				if(!Conekta.card.validateCVC()) {
					alert('El código de seguridad no es un entero válido (de 3 a 4 caracteres), favor de verificar.');
					return false;
				}
				
				/* Este validador regresa el tipo de tarjeta como un string. Puedes usar diferentes tipos de tarjeta como Visa, MasterCard y American Express. Si la tarjeta no puede ser reconocida, se regresará el string de Unknown. */
				if('unknown' == Conekta.card.getBrand()) {
					alert('La tarjeta no puede ser reconocida, favor de verificar.');
					return false;
				}
			}
		</script>
	</body>
</html>